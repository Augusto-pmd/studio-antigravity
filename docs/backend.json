{
  "entities": {
    "User": {
      "title": "User",
      "type": "object",
      "description": "Represents a user within the PMD Manager system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "role": {
          "type": "string",
          "description": "The role of the user within the system (e.g., Direction, Supervisor, Administration, Operator)."
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture."
        }
      },
      "required": [
        "id",
        "role",
        "fullName",
        "email"
      ]
    },
    "Project": {
      "title": "Project",
      "type": "object",
      "description": "Represents a construction project managed within the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the project."
        },
        "client": {
          "type": "string",
          "description": "The name of the client for the project."
        },
        "address": {
          "type": "string",
          "description": "The physical address of the project."
        },
        "currency": {
          "type": "string",
          "enum": [
            "ARS",
            "USD"
          ],
          "description": "The currency for the project's budget and expenses."
        },
        "projectType": {
          "type": "string",
          "description": "The type of project (e.g., Comercial, Residencial)."
        },
        "status": {
          "type": "string",
          "enum": [
            "En Curso",
            "Completado",
            "Pausado",
            "Cancelado"
          ],
          "description": "The current status of the project."
        },
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "The start date of the project."
        },
        "endDate": {
          "type": "string",
          "format": "date-time",
          "description": "The planned end date of the project."
        },
        "supervisor": {
          "type": "string",
          "description": "The name of the supervisor in charge of the project."
        },
        "budget": {
          "type": "number",
          "description": "The total budget allocated for the project."
        },
        "balance": {
          "type": "number",
          "description": "The remaining balance of the contract."
        },
        "progress": {
          "type": "number",
          "description": "The completion percentage of the project."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the project."
        }
      },
      "required": [
        "id",
        "name",
        "client",
        "address",
        "currency",
        "status",
        "supervisor",
        "budget"
      ]
    },
    "Expense": {
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense incurred for a specific project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Expense)"
        },
        "date": {
          "type": "string",
          "description": "The date the expense was incurred.",
          "format": "date-time"
        },
        "supplierId": {
          "type": "string",
          "description": "The ID of the supplier."
        },
        "categoryId": {
          "type": "string",
          "description": "The ID of the expense category."
        },
        "documentType": {
          "type": "string",
          "enum": [
            "Factura",
            "Recibo Común"
          ]
        },
        "invoiceNumber": {
          "type": "string"
        },
        "paymentMethod": {
          "type": "string"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "iva": {
          "type": "number"
        },
        "iibb": {
          "type": "number"
        },
        "iibbJurisdiction": {
          "type": "string",
          "enum": [
            "No Aplica",
            "CABA",
            "Provincia"
          ]
        },
        "currency": {
          "type": "string",
          "enum": [
            "ARS",
            "USD"
          ]
        },
        "exchangeRate": {
          "type": "number"
        },
        "receiptUrl": {
          "type": "string",
          "description": "URL of the receipt image."
        },
        "retencionGanancias": {
          "type": "number",
          "description": "Retención de Impuesto a las Ganancias aplicada al pago."
        },
        "retencionIVA": {
          "type": "number",
          "description": "Retención de IVA aplicada al pago."
        },
        "retencionIIBB": {
          "type": "number",
          "description": "Retención de Ingresos Brutos aplicada al pago."
        },
        "retencionSUSS": {
          "type": "number",
          "description": "Retención de SUSS (Seguridad Social) aplicada al pago."
        }
      },
      "required": [
        "id",
        "projectId",
        "date",
        "supplierId",
        "categoryId",
        "amount",
        "currency",
        "exchangeRate",
        "documentType"
      ]
    },
    "CashAccount": {
      "title": "CashAccount",
      "type": "object",
      "description": "Represents one of a user's cash accounts (up to 3 per user) in ARS for managing funds.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cash account entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CashAccount)"
        },
        "name": {
          "type": "string",
          "description": "A descriptive name for the account (e.g., 'Caja Principal ARS')."
        },
        "currency": {
          "type": "string",
          "description": "The currency of the cash account, always 'ARS'."
        },
        "balance": {
          "type": "number",
          "description": "The current balance of the cash account."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "currency",
        "balance"
      ]
    },
    "CashTransaction": {
      "title": "Cash Transaction",
      "type": "object",
      "description": "Represents a single transaction (income, expense, or transfer) within a user's cash account.",
      "properties": {
        "id": {
          "type": "string"
        },
        "userId": {
          "type": "string"
        },
        "date": {
          "type": "string",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "enum": [
            "Ingreso",
            "Egreso",
            "Refuerzo",
            "Transferencia"
          ]
        },
        "amount": {
          "type": "number"
        },
        "currency": {
          "type": "string",
          "description": "The currency of the transaction, always 'ARS'."
        },
        "description": {
          "type": "string"
        },
        "relatedExpenseId": {
          "type": "string"
        },
        "relatedProjectId": {
          "type": "string"
        },
        "operatorId": {
          "type": "string"
        },
        "operatorName": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "type",
        "amount",
        "currency",
        "description"
      ]
    },
    "Supplier": {
      "title": "Supplier",
      "type": "object",
      "description": "Represents a supplier providing goods or services to the company.",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "cuit": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone": {
          "type": "string"
        },
        "contactPerson": {
          "type": "string"
        },
        "address": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": [
            "Aprobado",
            "Pendiente",
            "Rechazado"
          ]
        },
        "type": {
          "type": "string",
          "enum": [
            "Servicios",
            "Materiales",
            "Mixto"
          ]
        },
        "fiscalCondition": {
          "type": "string"
        },
        "notes": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "name",
        "cuit",
        "status",
        "type"
      ]
    },
    "Contractor": {
      "title": "Contractor",
      "type": "object",
      "description": "Represents a contractor providing services to the company.",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "cuit": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone": {
          "type": "string"
        },
        "contactPerson": {
          "type": "string"
        },
        "address": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": [
            "Aprobado",
            "Pendiente",
            "Rechazado"
          ]
        },
        "fiscalCondition": {
          "type": "string"
        },
        "notes": {
          "type": "string"
        },
        "insuranceExpiryDate": {
          "type": "string",
          "format": "date-time"
        },
        "artExpiryDate": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "cuit",
        "status"
      ]
    },
    "ContractorEmployee": {
      "title": "ContractorEmployee",
      "type": "object",
      "description": "Represents an employee of a contractor.",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "contractorId": {
          "type": "string"
        },
        "artExpiryDate": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "contractorId"
      ]
    },
    "Employee": {
      "title": "Employee",
      "type": "object",
      "description": "Represents an employee of the company.",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": [
            "Activo",
            "Inactivo"
          ]
        },
        "paymentType": {
          "type": "string",
          "enum": [
            "Diario",
            "Semanal"
          ]
        },
        "category": {
          "type": "string"
        },
        "dailyWage": {
          "type": "number"
        },
        "artExpiryDate": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "status",
        "paymentType",
        "category",
        "dailyWage"
      ]
    },
    "Contract": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contract",
      "type": "object",
      "description": "Represents a contract associated with a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the contract entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Contract)"
        },
        "description": {
          "type": "string",
          "description": "A description of the contract."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the contract."
        },
        "remainingAmount": {
          "type": "number",
          "description": "The remaining amount on the contract."
        }
      },
      "required": [
        "id",
        "projectId",
        "description",
        "totalAmount",
        "remainingAmount"
      ]
    },
    "Asset": {
      "title": "Asset",
      "type": "object",
      "description": "Represents a company asset.",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "purchaseDate": {
          "type": "string",
          "format": "date-time"
        },
        "purchaseValue": {
          "type": "number"
        },
        "currency": {
          "type": "string",
          "enum": [
            "ARS",
            "USD"
          ]
        },
        "category": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": [
            "Activo",
            "Mantenimiento",
            "Vendido",
            "De Baja"
          ]
        }
      },
      "required": [
        "id",
        "name",
        "purchaseDate",
        "purchaseValue",
        "currency",
        "category",
        "status"
      ]
    },
    "TaskRequest": {
      "title": "Task Request",
      "type": "object",
      "description": "Represents a task or request assigned by one user to another.",
      "properties": {
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "requesterId": {
          "type": "string"
        },
        "requesterName": {
          "type": "string"
        },
        "assigneeId": {
          "type": "string"
        },
        "assigneeName": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": [
            "Pendiente",
            "Finalizado"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "completedAt": {
          "type": "string",
          "format": "date-time"
        },
        "projectId": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "title",
        "requesterId",
        "requesterName",
        "assigneeId",
        "assigneeName",
        "status",
        "createdAt"
      ]
    },
    "FundRequest": {
      "title": "Fund Request",
      "type": "object",
      "description": "Represents a request for funds for the weekly payment sheet.",
      "properties": {
        "id": {
          "type": "string"
        },
        "requesterId": {
          "type": "string"
        },
        "requesterName": {
          "type": "string"
        },
        "date": {
          "type": "string",
          "format": "date-time"
        },
        "category": {
          "type": "string",
          "enum": [
            "Logística y PMD",
            "Materiales",
            "Viáticos",
            "Caja Chica",
            "Otros"
          ]
        },
        "projectId": {
          "type": "string"
        },
        "amount": {
          "type": "number"
        },
        "currency": {
          "type": "string",
          "enum": [
            "ARS",
            "USD"
          ]
        },
        "exchangeRate": {
          "type": "number"
        },
        "status": {
          "type": "string",
          "enum": [
            "Pendiente",
            "Aprobado",
            "Pagado",
            "Rechazado"
          ]
        }
      },
      "required": [
        "id",
        "requesterId",
        "requesterName",
        "date",
        "category",
        "amount",
        "currency",
        "exchangeRate",
        "status"
      ]
    },
    "PayrollWeek": {
      "title": "Payroll Week",
      "type": "object",
      "description": "Represents a weekly payroll period for attendance and payments.",
      "properties": {
        "id": {
          "type": "string"
        },
        "startDate": {
          "type": "string",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": [
            "Abierta",
            "Cerrada"
          ]
        },
        "generatedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "startDate",
        "endDate",
        "status",
        "generatedAt"
      ]
    },
    "CashAdvance": {
      "title": "Cash Advance",
      "type": "object",
      "description": "Represents a cash advance given to an employee during a payroll week.",
      "properties": {
        "id": {
          "type": "string"
        },
        "employeeId": {
          "type": "string"
        },
        "employeeName": {
          "type": "string"
        },
        "projectId": {
          "type": "string"
        },
        "projectName": {
          "type": "string"
        },
        "date": {
          "type": "string",
          "format": "date-time"
        },
        "amount": {
          "type": "number"
        },
        "reason": {
          "type": "string"
        },
        "payrollWeekId": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "employeeId",
        "employeeName",
        "date",
        "amount",
        "payrollWeekId"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership ensures only the user (or admin) can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cashAccounts/{cashAccountId}",
        "definition": {
          "entityName": "CashAccount",
          "schema": {
            "$ref": "#/backend/entities/CashAccount"
          },
          "description": "Stores a user's cash accounts (up to 3). Path-based ownership ensures only the user can access their own cash accounts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "cashAccountId",
              "description": "The unique identifier for the cash account."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cashAccounts/{cashAccountId}/transactions/{transactionId}",
        "definition": {
          "entityName": "CashTransaction",
          "schema": {
            "$ref": "#/backend/entities/CashTransaction"
          },
          "description": "Stores transaction history for a specific cash account. Inherits ownership from the parent user document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "cashAccountId",
              "description": "The unique identifier for the cash account."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores project details. Includes denormalized 'members' map for authorization independence.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expenses associated with a project. Inherits authorization context (members) from the parent Project document for Authorization Independence.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense."
            }
          ]
        }
      },
      {
        "path": "/suppliers/{supplierId}",
        "definition": {
          "entityName": "Supplier",
          "schema": {
            "$ref": "#/backend/entities/Supplier"
          },
          "description": "Stores supplier information.",
          "params": [
            {
              "name": "supplierId",
              "description": "The unique identifier for the supplier."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/contracts/{contractId}",
        "definition": {
          "entityName": "Contract",
          "schema": {
            "$ref": "#/backend/entities/Contract"
          },
          "description": "Stores contracts associated with a project. Inherits authorization context (members) from the parent Project document for Authorization Independence.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "contractId",
              "description": "The unique identifier for the contract."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores company employee information.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            }
          ]
        }
      },
      {
        "path": "/contractors/{contractorId}",
        "definition": {
          "entityName": "Contractor",
          "schema": {
            "$ref": "#/backend/entities/Contractor"
          },
          "description": "Stores contractor information.",
          "params": [
            {
              "name": "contractorId",
              "description": "The unique identifier for the contractor."
            }
          ]
        }
      },
      {
        "path": "/contractors/{contractorId}/personnel/{personnelId}",
        "definition": {
          "entityName": "ContractorEmployee",
          "schema": {
            "$ref": "#/backend/entities/ContractorEmployee"
          },
          "description": "Stores personnel for a specific contractor.",
          "params": [
            {
              "name": "contractorId",
              "description": "The unique identifier for the contractor."
            },
            {
              "name": "personnelId",
              "description": "The unique identifier for the personnel."
            }
          ]
        }
      },
      {
        "path": "/assets/{assetId}",
        "definition": {
          "entityName": "Asset",
          "schema": {
            "$ref": "#/backend/entities/Asset"
          },
          "description": "Stores company assets information.",
          "params": [
            {
              "name": "assetId",
              "description": "The unique identifier for the asset."
            }
          ]
        }
      },
      {
        "path": "/taskRequests/{taskRequestId}",
        "definition": {
          "entityName": "TaskRequest",
          "schema": {
            "$ref": "#/backend/entities/TaskRequest"
          },
          "description": "Stores tasks and requests between users. Users can read tasks assigned to or created by them.",
          "params": [
            {
              "name": "taskRequestId",
              "description": "The unique identifier for the task request."
            }
          ]
        }
      },
      {
        "path": "/fundRequests/{fundRequestId}",
        "definition": {
          "entityName": "FundRequest",
          "schema": {
            "$ref": "#/backend/entities/FundRequest"
          },
          "description": "Stores fund requests for the weekly payment sheet. Users can read their own requests, admins can manage all.",
          "params": [
            {
              "name": "fundRequestId",
              "description": "The unique identifier for the fund request."
            }
          ]
        }
      },
      {
        "path": "/payrollWeeks/{payrollWeekId}",
        "definition": {
          "entityName": "PayrollWeek",
          "schema": {
            "$ref": "#/backend/entities/PayrollWeek"
          },
          "description": "Stores weekly payroll periods. Only admins can create or modify these.",
          "params": [
            {
              "name": "payrollWeekId",
              "description": "The unique identifier for the payroll week."
            }
          ]
        }
      },
      {
        "path": "/cashAdvances/{cashAdvanceId}",
        "definition": {
          "entityName": "CashAdvance",
          "schema": {
            "$ref": "#/backend/entities/CashAdvance"
          },
          "description": "Stores employee cash advances. Admins can manage all.",
          "params": [
            {
              "name": "cashAdvanceId",
              "description": "The unique identifier for the cash advance."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the PMD Manager application, focusing on role-based access control, project-specific data segregation, and financial tracking. Authorization Independence is achieved through path-based ownership for user-specific data and denormalization of membership within project-related collections. This eliminates the need for `get()` calls in security rules, simplifying them and ensuring atomic operations. Segregation ensures that each collection has a homogeneous security posture. QAPs are supported through structural segregation, making list operations secure and predictable.\n\nUser data is stored in a dedicated collection (`/users/{userId}`) for private data. Project-related data (expenses, contracts) are nested under the `/projects/{projectId}` collection, which may contain denormalized members that explicitly grant access. User cash accounts are stored under the user's document (`/users/{userId}/cashAccount`), ensuring that only the owning user has access.\n\nSupplier information is stored in the root collection `/suppliers` since it is shared, and may involve cross-project authorization. The structure also enables straightforward querying and data aggregation for dashboard visualizations."
  }
}
